# Task 6.4.3 - CI Templates & Workflows Design

**Tool:** Gemini Antimatter (Design Doc)
**Phase:** 6.4 - Engineering Framework & Tooling
**Dependencies:** 6.4.1 (CLI UX Design)
**Owner:** Gemini Antimatter

---

## Prompt for Gemini Antimatter

You are helping maintain architectural documentation for the lattice-lock-framework.

Task ID: 6.4.3 - CI Templates & Workflows Design

### Context

The framework needs CI templates that:
1. Install dependencies correctly
2. Run `lattice-lock validate`
3. Run Sheriff and Gauntlet
4. Run pytest
5. Report results clearly

**Existing CI:**
- `src/lattice_lock_cli/templates/ci/github/` - GitHub Actions templates exist
- AWS CodePipeline templates (Phase 2)
- GCP Cloud Build templates (Phase 2)

**Current Issues:**
- Test collection fails due to missing dependencies
- `pyproject.toml` doesn't list all required deps

### Goals

Write a design document covering:

1. **GitHub Actions Workflow**
   Design a minimal, working workflow:
   ```yaml
   name: Lattice Lock CI
   on: [push, pull_request]
   jobs:
     validate:
       runs-on: ubuntu-latest
       steps:
         - uses: actions/checkout@v4
         - uses: actions/setup-python@v5
           with:
             python-version: '3.10'
         - name: Install dependencies
           run: pip install -e ".[dev]"
         - name: Validate
           run: lattice-lock validate
         - name: Test
           run: pytest
   ```

2. **Dependency Groups**
   Define what goes in `pyproject.toml`:
   - Core dependencies (required for library)
   - Dev dependencies (testing, linting)
   - CLI dependencies (click, rich)
   - Optional dependencies (providers)

3. **Missing Dependencies**
   Identify and list all missing deps:
   - `click` - CLI framework
   - Any others found during test collection

4. **Workflow Variants**
   - Basic: validate + test
   - Full: validate + sheriff + gauntlet + test + coverage
   - Quick: lint only (for draft PRs)

5. **Caching Strategy**
   - pip cache
   - Model cache (for local models)

6. **Matrix Testing**
   - Python versions: 3.10, 3.11, 3.12
   - OS: ubuntu-latest (primary), macos-latest (optional)

7. **Secrets Management**
   - How to handle API keys in CI
   - Skip provider tests without keys
   - Mock strategies

8. **Implementation Tasks**
   List concrete tasks for Devin AI:
   - Files to create/modify
   - Dependencies to add
   - Tests to verify CI works

### Reference Files

- `pyproject.toml` - Current dependencies
- `src/lattice_lock_cli/templates/ci/` - Existing templates
- `.github/workflows/` - If exists
