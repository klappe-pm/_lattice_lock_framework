# Task 6.2.1 - Governance Core & lattice.yaml Specification

**Tool:** Gemini Antimatter (Design Doc)
**Phase:** 6.2 - Governance Core Loop
**Dependencies:** None
**Owner:** Gemini Antimatter

---

## Prompt for Gemini Antimatter

You are helping maintain architectural documentation for the lattice-lock-framework.

Task ID: 6.2.1 - Governance Core & lattice.yaml Specification

### Context

The Lattice Lock Framework advertises a "schema-first governance core" where:
1. Developers define schemas in `lattice.yaml`
2. The Polyglot Compiler transforms schemas into enforcement artifacts
3. Sheriff validates AST compliance
4. Gauntlet runs semantic contract tests

**Current State:**
- `src/lattice_lock_validator/schema.py` - Schema validation exists
- `src/lattice_lock_gauntlet/generator.py` - Test generation exists
- `src/lattice_lock_gauntlet/parser.py` - Schema parsing exists
- **MISSING:** No canonical `lattice.yaml` example in the repo
- **MISSING:** No `compile_lattice` entrypoint that orchestrates the full pipeline

### Goals

Write a comprehensive specification document covering:

1. **Canonical lattice.yaml Format**
   - Provide a complete, minimal example (2-3 entities)
   - Document all supported field types
   - Document all constraint types (gt, lt, gte, lte, unique, etc.)
   - Document `ensures:` clause syntax for semantic contracts
   - Version field semantics

   Example structure to define:
   ```yaml
   version: v2.1
   generated_module: types_v2
   
   entities:
     EntityName:
       fields:
         field_name: type
       constraints:
         field_name: {constraint: value}
       ensures:
         - "semantic contract expression"
   ```

2. **Compilation Pipeline**
   - Input: `lattice.yaml` file path
   - Step 1: Load and parse YAML
   - Step 2: Validate against meta-schema
   - Step 3: Generate Pydantic models (optional)
   - Step 4: Generate SQLModel ORM (optional)
   - Step 5: Generate Gauntlet test contracts (required)
   - Output: Generated files in specified module directory

3. **compile_lattice API Surface**
   - Python function signature
   - CLI command interface
   - Configuration options (what to generate)
   - Error handling and reporting
   - Return values / exit codes

4. **Integration Points**
   - How Sheriff hooks into the pipeline
   - How Gauntlet tests are discovered and run
   - How generated code is imported by user code

5. **File Locations**
   - Where `compile_lattice.py` should live
   - Where generated files should be placed
   - Naming conventions for generated modules

6. **Implementation Tasks**
   List concrete tasks for Devin AI:
   - Files to create
   - Functions to implement
   - Tests to write

### Reference Files

- `src/lattice_lock_validator/schema.py` - Existing validation
- `src/lattice_lock_gauntlet/generator.py` - Test generation
- `src/lattice_lock_gauntlet/parser.py` - Schema parsing
- `specifications/lattice_lock_framework_specifications.md` - Full spec
