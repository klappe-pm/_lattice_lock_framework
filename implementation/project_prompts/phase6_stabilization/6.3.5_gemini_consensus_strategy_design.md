# Task 6.3.5 - Multi-Model Consensus Strategy Design

**Tool:** Gemini Antimatter (Design Doc)
**Phase:** 6.3 - Orchestrator Feature Completeness
**Dependencies:** None (can run parallel with other 6.3.x)
**Owner:** Gemini Antimatter

---

## Prompt for Gemini Antimatter

You are helping maintain architectural documentation for the lattice-lock-framework.

Task ID: 6.3.5 - Multi-Model Consensus Strategy Design

### Context

The framework mentions consensus patterns but:
- `create_consensus_group()` returns "not yet implemented"
- No actual multi-model voting logic exists
- CLI has `consensus` command that doesn't work

**Documented Patterns (from specs):**
- Parallel Consensus: Multiple models vote on answer
- Chain of Thought: Sequential processing
- Hierarchical Refinement: Cheap â†’ expensive escalation

### Goals

Write a design document covering:

1. **Consensus Strategy Definition**
   Define at least one working strategy:
   ```python
   class ConsensusStrategy:
       def __init__(self, models: list[str], reconciliation: str):
           ...
       
       async def execute(self, prompt: str) -> ConsensusResult:
           ...
   ```

2. **Model Selection for Consensus**
   - How many models to use (configurable, default 3)
   - Which models to select (top N for task type)
   - Diversity requirements (different providers?)

3. **Reconciliation Methods**
   - **Majority Vote**: For classification/yes-no questions
   - **LLM-as-Judge**: Use another model to pick best answer
   - **Merge**: Combine answers (for creative tasks)
   - **Confidence-Weighted**: Weight by model confidence scores

4. **Result Structure**
   ```python
   @dataclass
   class ConsensusResult:
       final_answer: str
       individual_responses: list[ModelResponse]
       reconciliation_method: str
       confidence: float
       agreement_score: float  # How much models agreed
   ```

5. **When to Use Consensus**
   - Task types that benefit from consensus
   - Cost/latency tradeoffs
   - Configuration flags

6. **CLI Integration**
   ```bash
   orchestrator_cli.py consensus "Is this code thread-safe?" --num 3 --method vote
   ```

7. **Telemetry**
   - Track consensus vs single-model accuracy
   - Cost of consensus operations
   - Agreement patterns

8. **Implementation Tasks**
   List concrete tasks for Devin AI:
   - Files to create
   - Integration points
   - Tests to write

### Reference Files

- `src/lattice_lock_orchestrator/core.py` - Orchestrator
- `scripts/orchestrator_cli.py` - CLI
- `specifications/lattice_lock_framework_specifications.md` - Patterns
