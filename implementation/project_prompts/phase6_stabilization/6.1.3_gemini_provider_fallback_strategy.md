# Task 6.1.3 - Provider Client and Fallback Strategy Design

**Tool:** Gemini Antimatter (Design Doc)
**Phase:** 6.1 - Breaking Issues / Orchestrator Contract Hardening
**Dependencies:** 6.1.1 (light dependency)
**Owner:** Gemini Antimatter

---

## Prompt for Gemini Antimatter

You are helping maintain architectural documentation for the lattice-lock-framework.

Task ID: 6.1.3 - Provider Client and Fallback Strategy Design

### Context

The framework claims support for 8 providers and 63 models, but several providers are not fully implemented:

**Current Provider Status:**
- `OpenAIClient` - Implemented
- `AnthropicClient` - Implemented
- `OllamaClient` - Implemented
- `GoogleClient` - Partially implemented
- `XAIClient` - Partially implemented
- `AzureOpenAIClient` - Partially implemented
- `BedrockClient` - Raises `NotImplementedError`
- `DIALClient` - Partially implemented

**Key Issue:** `BedrockClient._call_api()` explicitly raises `NotImplementedError`, causing runtime failures if Bedrock models are selected.

### Goals

Write a design document covering:

1. **Provider Maturity Classification**
   - Define tiers: Production, Beta, Experimental, Planned
   - Classify each of the 8 providers
   - Define what each tier means for users

2. **Bedrock Decision**
   - Option A: Implement minimal working Bedrock client
   - Option B: Mark as "experimental" and gate behind feature flag
   - Option C: Remove from registry until implemented
   - Recommendation with rationale

3. **Required Environment Variables**
   - For each provider, list required credentials
   - Define validation behavior when credentials missing
   - Error messages for misconfiguration

4. **Fallback Behavior**
   - What happens when a provider is unavailable?
   - What happens when credentials are missing?
   - How does this interact with fallback chains in `core.py`?
   - Should unavailable providers be silently skipped or hard-fail?

5. **Provider Health Checks**
   - How to detect if a provider is available at startup
   - Caching strategy for health status
   - Retry behavior for transient failures

6. **Implementation Tasks**
   List concrete tasks for Devin AI:
   - Files to modify
   - Feature flags to add
   - Tests to write
   - Documentation updates

### Reference Files

- `src/lattice_lock_orchestrator/api_clients.py` - Client implementations
- `src/lattice_lock_orchestrator/core.py` - Fallback logic
- `src/lattice_lock_orchestrator/registry.py` - Model registration
- `models/model_registry.md` - Documented models per provider
