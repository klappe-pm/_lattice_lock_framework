# Engineering Framework CLI UX Design

**Task ID:** 6.4.1
**Phase:** 6.4 (Engineering Framework & Tooling)
**Author:** Gemini Antimatter
**Status:** Approved Design

## 1. Overview
The **Lattice Lock CLI** (`lattice-lock` or `ll`) aggregates all framework capabilities (Validation, Governance, Orchestration, Testing) into a single cohesive developer tool. It replaces disparate scripts and ensures a consistent workflow.

## 2. Command Structure

The CLI uses a subcommand architecture (built with `click` or `typer`).

### 2.1 Global Options
*   `--verbose / -v`: Enable debug logging.
*   `--json`: Output results in JSON format (for CI/CD pipes).
*   `--config <path>`: Override default config file location.
*   `--version`: Show version info.

### 2.2 Core Commands

#### `lattice-lock init [PROJECT_NAME]`
Scaffolds a new Lattice Lock project.
*   **Arguments**: `PROJECT_NAME` (optional, defaults to current dir name)
*   **Options**:
    *   `--template <name>`: Scaffolding template (default: `basic`).
    *   `--no-git`: Skip git init.
    *   `--ci <provider>`: Generate CI config (e.g., `github`, `gitlab`).
*   **Action**: Creates `lattice.yaml`, `src/`, `tests/`, and installs default dependencies.

#### `lattice-lock validate`
Runs all static validation checks.
*   **Options**:
    *   `--schema-only`: Only check `lattice.yaml` validity.
    *   `--sheriff-only`: Only check AST/Architecture rules.
*   **Action**: Runs Schema Validator -> Sheriff. Fails if any violations found.

#### `lattice-lock compile`
Compiles `lattice.yaml` into runtime artifacts (Pydantic models, SQL schemas).
*   **Options**:
    *   `--output <dir>`: Target directory for artifacts.
    *   `--language <lang>`: Output language (default: `python`).

#### `lattice-lock sheriff`
Detailed architecture enforcement (AST analysis).
*   **Options**:
    *   `--fix`: Auto-fix fixable violations (e.g., simple import moves).
    *   `--report <path>`: Save detailed violation report.

#### `lattice-lock gauntlet`
Runs semantic contract tests (Pytest wrapper).
*   **Options**:
    *   `--generate`: Re-generate test files from `ensures` clauses before running.
    *   `--coverage`: Fail if contract coverage < threshold.

### 2.3 Orchestrator Commands (New)
Integrate the model orchestration features directly into the CLI.

#### `lattice-lock route "<PROMPT>"`
Routes a prompt to the best model and executes it.
*   **Options**:
    *   `--model <id>`: Force specific model.
    *   `--strategy <name>`: Use `consensus` or `single`.
    *   `--dry-run`: Show which model *would* be selected without calling API.

#### `lattice-lock analyze "<PROMPT>"`
Runs the `TaskAnalyzer` on the prompt.
*   **Output**: Task type, confidence scores, estimated cost/complexity.
*   **Use Case**: Debugging routing logic.

#### `lattice-lock consensus "<PROMPT>"`
Shortcut for `route --strategy consensus`.
*   **Options**:
    *   `--count <n>`: Number of models.
    *   `--method <method>`: `vote`, `judge`, etc.

## 3. Output Formatting
*   **Library**: Use `rich` for terminal output.
*   **Experience**:
    *   **Success**: Green checks, brief summary.
    *   **Failure**: Red headers, clear error code, **Actionable Hint**.
    *   **Progress**: Spinners for API calls, Progress Bars for test suites.
*   **Actionable Error Example**:
    ```text
    [bold red]Validation Error (E204)[/bold red]: Module 'auth' imports from 'ui'
    [yellow]Violation[/yellow]: Layer violations detected. 'auth' is lower layer than 'ui'.
    [green]Fix[/green]: Move logic to 'common' or use dependency injection.
    ```

## 4. Configuration
The CLI looks for configuration in priority order:
1.  CLI Flags
2.  Environment Variables (`LATTICE_LOCK_*`)
3.  `.lattice-lock.yaml` (Project root)
4.  `pyproject.toml` (under `[tool.lattice-lock]`)

```yaml
# .lattice-lock.yaml example
project:
  name: "my-app"
  
sheriff:
  ignore: ["legacy/*"]

orchestrator:
  default_model: "gpt-4-turbo"
  cost_limit_daily: 5.0
```

## 5. Implementation Plan (Devin AI)
1.  **Refactor**: Move `src/lattice_lock_cli` to be the main entry point.
2.  **Dependencies**: Add `typer` and `rich`.
3.  **Migration**: Port functionality from `scripts/orchestrator_cli.py` into `src/lattice_lock_cli/commands/orchestrator.py`.
4.  **New Commands**: Implement `init`, `validate`, `compile` stubs that call respective modules.
