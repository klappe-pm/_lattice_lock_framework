# Advanced Lattice Lock Schema Example
# This example demonstrates all supported features including:
# - All field types (uuid, str, int, decimal, bool, enum)
# - All constraint types (gt, lt, gte, lte, unique, primary_key)
# - Ensures clauses for semantic contracts
# - Interface definitions for service contracts

version: v2.1
generated_module: ecommerce_types

entities:
  # Customer entity with comprehensive validation
  Customer:
    fields:
      id:
        type: uuid
        primary_key: true
      email:
        type: str
        unique: true
      name:
        type: str
      credit_score:
        type: int
        gte: 300
        lte: 850
      account_balance:
        type: decimal
        scale: 2
        gte: 0
      membership_tier:
        type: enum
        enum: [bronze, silver, gold, platinum]
        default: bronze
      verified:
        type: bool
        default: false
    ensures:
      - name: platinum_requires_high_credit
        field: credit_score
        constraint: gte
        value: 750
        description: "Platinum members must have credit score >= 750"

  # Product entity with inventory constraints
  Product:
    fields:
      id:
        type: uuid
        primary_key: true
      sku:
        type: str
        unique: true
      name:
        type: str
      price:
        type: decimal
        scale: 2
        gt: 0
      cost:
        type: decimal
        scale: 2
        gte: 0
      stock_quantity:
        type: int
        gte: 0
      category:
        type: enum
        enum: [electronics, clothing, food, furniture, other]
      active:
        type: bool
        default: true
    ensures:
      - name: price_exceeds_cost
        field: price
        constraint: gt
        value: 0
        description: "Product price must be greater than zero"

  # Order entity with complex business rules
  Order:
    fields:
      id:
        type: uuid
        primary_key: true
      customer_id:
        type: uuid
      total_amount:
        type: decimal
        scale: 2
        gt: 0
        lte: 100000
      discount_percent:
        type: decimal
        scale: 2
        gte: 0
        lte: 100
      status:
        type: enum
        enum: [pending, confirmed, processing, shipped, delivered, cancelled, refunded]
        default: pending
      priority:
        type: enum
        enum: [low, normal, high, urgent]
        default: normal
      item_count:
        type: int
        gt: 0
        lte: 100
    ensures:
      - name: high_value_order_limit
        field: total_amount
        constraint: lte
        value: 100000
        description: "Orders over $100,000 require manual approval"
      - name: discount_limit
        field: discount_percent
        constraint: lte
        value: 50
        description: "Maximum discount is 50% without manager approval"

  # Payment entity for financial transactions
  Payment:
    fields:
      id:
        type: uuid
        primary_key: true
      order_id:
        type: uuid
      amount:
        type: decimal
        scale: 2
        gt: 0
      method:
        type: enum
        enum: [credit_card, debit_card, paypal, bank_transfer, crypto]
      status:
        type: enum
        enum: [pending, authorized, captured, failed, refunded]
        default: pending
      processed:
        type: bool
        default: false

  # Review entity with rating constraints
  Review:
    fields:
      id:
        type: uuid
        primary_key: true
      product_id:
        type: uuid
      customer_id:
        type: uuid
      rating:
        type: int
        gte: 1
        lte: 5
      verified_purchase:
        type: bool
        default: false

# Interface definitions for service contracts
interfaces:
  OrderService:
    methods:
      create_order:
        params:
          customer: Customer
          items: str
        returns: Order
      cancel_order:
        params:
          order: Order
        returns: bool

  PaymentService:
    methods:
      process_payment:
        params:
          order: Order
          method: str
        returns: Payment
      refund_payment:
        params:
          payment: Payment
        returns: bool
