# Advanced Lattice Lock Schema Example
# This example demonstrates all supported features including:
# - Multiple entities with relationships
# - All constraint types (gt, lt, gte, lte, unique, primary_key)
# - Enum fields with defaults
# - Ensures clauses for semantic contracts
# - Interface definitions with method signatures

version: v2.1
generated_module: types_advanced

# Configuration section
config:
  forbidden_imports:
    - requests
    - psycopg2
    - sqlite3
  orm_engine: sqlmodel

# Entity definitions
entities:
  # Customer entity with comprehensive field types
  Customer:
    description: "Represents a customer in the system"
    persistence: table
    fields:
      id:
        type: uuid
        primary_key: true
      email:
        type: str
        unique: true
      name:
        type: str
      credit_limit:
        type: decimal
        gte: 0
        lte: 100000
        scale: 2
      tier:
        type: enum
        enum: [bronze, silver, gold, platinum]
        default: bronze
      active:
        type: bool
        default: true
      loyalty_points:
        type: int
        gte: 0
    ensures:
      - name: credit_limit_by_tier
        field: credit_limit
        constraint: lte
        value: 100000
        description: "Credit limit cannot exceed $100,000"

  # Order entity demonstrating relationships and complex constraints
  Order:
    description: "Represents a customer order"
    persistence: table
    fields:
      id:
        type: uuid
        primary_key: true
      customer_id:
        type: uuid
      total_amount:
        type: decimal
        gt: 0
        scale: 2
      discount_percent:
        type: decimal
        gte: 0
        lte: 100
        scale: 2
      status:
        type: enum
        enum: [pending, confirmed, shipped, delivered, cancelled]
        default: pending
      priority:
        type: int
        gte: 1
        lte: 5
    ensures:
      - name: max_order_amount
        field: total_amount
        constraint: lte
        value: 50000
        description: "Orders exceeding $50,000 require manual approval"
      - name: valid_discount
        field: discount_percent
        constraint: lte
        value: 50
        description: "Maximum discount is 50%"

  # Product entity with inventory constraints
  Product:
    description: "Represents a product in the catalog"
    persistence: table
    fields:
      id:
        type: uuid
        primary_key: true
      sku:
        type: str
        unique: true
      name:
        type: str
      price:
        type: decimal
        gt: 0
        scale: 2
      cost:
        type: decimal
        gt: 0
        scale: 2
      stock_quantity:
        type: int
        gte: 0
      reorder_level:
        type: int
        gte: 0
      category:
        type: enum
        enum: [electronics, clothing, food, home, other]
        default: other
    ensures:
      - name: positive_margin
        field: price
        constraint: gt
        value: 0
        description: "Price must be positive to ensure margin"

  # OrderItem entity for order line items
  OrderItem:
    description: "Represents a line item in an order"
    persistence: table
    fields:
      id:
        type: uuid
        primary_key: true
      order_id:
        type: uuid
      product_id:
        type: uuid
      quantity:
        type: int
        gt: 0
        lte: 1000
      unit_price:
        type: decimal
        gt: 0
        scale: 2
      line_total:
        type: decimal
        gt: 0
        scale: 2

# Interface definitions for service contracts
interfaces:
  IOrderService:
    file: src/services/order_service.py
    scaffold: repository_pattern
    depends_on: []
    methods:
      create_order:
        params:
          customer: Customer
          items: list
        returns: Order
        ensures:
          - "result.status == 'pending'"

      update_status:
        params:
          order: Order
          new_status: str
        returns: Order
        ensures:
          - "result.status == new_status"

  ICustomerService:
    file: src/services/customer_service.py
    scaffold: repository_pattern
    depends_on: []
    methods:
      get_customer:
        params:
          customer_id: str
        returns: Customer

      update_tier:
        params:
          customer: Customer
          new_tier: str
        returns: Customer
        ensures:
          - "result.tier == new_tier"

  IInventoryService:
    file: src/services/inventory_service.py
    scaffold: repository_pattern
    depends_on: []
    methods:
      check_stock:
        params:
          product: Product
        returns: int

      reserve_stock:
        params:
          product: Product
          quantity: int
        returns: bool
        ensures:
          - "result == True or product.stock_quantity < quantity"
